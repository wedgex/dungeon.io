<html>
	<head>
		<script src="/socket.io/socket.io.js"></script>
		<script src="/js/underscore-min.js"></script>
		<script src="/js/jquery-2.0.2.min.js"></script>
	</head>
	<body>
		<ul id="players"></ul>
		<canvas id="map">
		</canvas>
		<script>
		  var socket = io.connect("/");
		  var players = [];
		  var context = document.getElementById('map').getContext('2d');

		  var redrawPlayerList = function() {
		  	var playersList = $('#players');
		  	playersList.empty();
		  	
		  	players.forEach(function(player) {
		  		playersList.append($('<li>', { text: player.name }));
		  	});
		  };

		  var drawPlayer = function(context, player) {
		  	context.strokeStyle = '#000000';
		  	context.fillStyle = player.color;
		  	context.beginPath();
		  	context.arc(player.x, player.y, 10, 0, Math.PI * 2, true);
		  	context.closePath();
		  	context.stroke();
		  	context.fill();
		  };

		  var redrawMap = function() {
		  	players.forEach(function(player) {
		  		drawPlayer(context, player);
		  	});
		  };

		  socket.on("connect", function() {
		  	var name = prompt("Enter your character's name");
		  	socket.emit('player join', name);
		  });

		  socket.on("player joined", function(player) {
		  	players.push(player);
		  	
		  	// TODO hook this up with an event
		  	redrawPlayerList();
		  	redrawMap();
		  });

		  socket.on("player left", function(playerThatLeft) {
		  	players = _.reject(players, function(player) {
		  		return player.id == playerThatLeft.id;
		  	});

		  	// TODO
		  	redrawPlayerList();
		  });

		</script>

	</body>
</html>